<div class="card bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden transition-all duration-300 hover:shadow-md">
    <!-- Header Section -->
    <div class="p-5 border-b border-slate-100 bg-white/50 backdrop-blur-sm flex flex-col md:flex-row justify-between items-center gap-4">
        <!-- Title & Count -->
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center text-brand-600">
                <i class="pi pi-table text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-bold text-slate-800 tracking-tight">{{ title | translate }}</h3>
                @if (data) {
                    <p class="text-xs text-slate-500 font-medium">
                        {{ data.length }} {{ 'common.records' | translate }}
                    </p>
                }
            </div>
        </div>
        
        <!-- Actions Toolbar -->
        <div class="flex items-center gap-3 w-full md:w-auto">
            <!-- Search Input -->
            <div class="relative w-full md:w-64 group">
                <i class="pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-brand-500 transition-colors z-10"></i>
                <input pInputText type="text" 
                       (input)="dt.filterGlobal($any($event.target).value, 'contains')" 
                       [placeholder]="'common.search' | translate"
                       class="w-full pl-10 pr-4 py-2.5 bg-slate-50 border-slate-200 rounded-xl text-sm focus:bg-white focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all" />
            </div>

            <!-- Add Button -->
            @if (showAddButton) {
                <button pButton pRipple 
                        *appHasPermission="addPermission"
                        [label]="'common.add' | translate" 
                        icon="pi pi-plus" 
                        class="p-button-primary rounded-xl h-10 font-medium text-sm shadow-sm hover:shadow-md transition-all"
                        (click)="add.emit()">
                </button>
            }

            <!-- Export Button -->
            <button pButton pRipple 
                    [label]="'common.export' | translate" 
                    icon="pi pi-download" 
                    class="p-button-outlined p-button-secondary rounded-xl h-10 border-slate-200 hover:bg-slate-50 hover:border-slate-300 text-slate-600 font-medium text-sm transition-all"
                    (click)="exportExcel()"
                    [disabled]="!data || data.length === 0">
            </button>
        </div>
    </div>

    <!-- Table Component -->
    <p-table #dt 
             [value]="data" 
             [columns]="cols"
             [loading]="loading"
             [paginator]="true" 
             [rows]="10" 
             [rowsPerPageOptions]="[5, 10, 25, 50, 100, 1000]" 
             [globalFilterFields]="getGlobalFilterFields()"
             styleClass="p-datatable-modern"
             responsiveLayout="scroll"
             [showCurrentPageReport]="true"
             [currentPageReportTemplate]="'dashboard.table.pageReport' | translate"
             [rowHover]="true"
             stateStorage="session"
             [stateKey]="tableId">

        <!-- Table Header -->
        <ng-template pTemplate="header">
            <tr>
                @for (col of cols; track col.field) {
                    <th [pSortableColumn]="col.field" 
                        class="bg-slate-50/50 p-4 text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-slate-100 first:pl-6 last:pr-6 cursor-pointer hover:bg-slate-100/50 transition-colors group">
                        <div class="flex items-center gap-2">
                            {{ col.header | translate }}
                            <p-sortIcon [field]="col.field" class="text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity"></p-sortIcon>
                        </div>
                    </th>
                }
                <th class="bg-slate-50/50 p-4 text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-slate-100 w-24 min-w-[6rem] text-center sticky right-0 bg-white z-10 shadow-[-4px_0_8px_-4px_rgba(0,0,0,0.1)]">
                    {{ 'common.actions' | translate }}
                </th>
            </tr>
        </ng-template>

        <!-- Table Body -->
        <ng-template pTemplate="body" let-rowData>
            <tr class="group border-b border-slate-50 last:border-0 hover:bg-slate-50/50 transition-all duration-200">
                @for (col of cols; track col.field) {
                    <td class="p-4 text-sm text-slate-600 font-medium first:pl-6 last:pr-6">
                        <!-- Custom rendering for specific fields could go here via templates, but for now generic -->
                        <span [ngClass]="{'px-2.5 py-1 rounded-lg text-xs font-bold': col.field === 'status' || col.field === 'severity'}"
                              [class]="getStatusClass(rowData[col.field], col.field)">
                            {{ getDisplayValue(rowData[col.field]) }}
                        </span>
                    </td>
                }
                <td class="p-4 text-center sticky right-0 bg-white group-hover:bg-slate-50/50 z-10 shadow-[-4px_0_8px_-4px_rgba(0,0,0,0.1)]">
                    <div class="flex items-center justify-center gap-2">
                        @if (showEditButton) {
                            <button pButton icon="pi pi-pencil" 
                                    *appHasPermission="editPermission"
                                    (click)="edit.emit(rowData)"
                                    class="p-button-text p-button-rounded p-button-sm w-8 h-8 text-slate-400 hover:text-brand-600 hover:bg-brand-50 transition-colors">
                            </button>
                        }
                        @if (showPermissionsButton) {
                            <button pButton icon="pi pi-shield" 
                                    *appHasPermission="permissionsPermission"
                                    (click)="permissions.emit(rowData)"
                                    class="p-button-text p-button-rounded p-button-sm w-8 h-8 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 transition-colors"
                                    [pTooltip]="'Manage Permissions'">
                            </button>
                        }
                        @if (showDeleteButton) {
                            <button pButton icon="pi pi-trash" 
                                    *appHasPermission="deletePermission"
                                    (click)="delete.emit(rowData)"
                                    class="p-button-text p-button-rounded p-button-sm w-8 h-8 text-slate-400 hover:text-rose-600 hover:bg-rose-50 transition-colors">
                            </button>
                        }
                    </div>
                </td>
            </tr>
        </ng-template>
        
        <!-- Empty State -->
        <ng-template pTemplate="emptymessage">
            <tr>
                <td [attr.colspan]="cols.length + 1" class="text-center p-8">
                    <div class="flex flex-col items-center justify-center text-slate-400">
                        <i class="pi pi-inbox text-4xl mb-3"></i>
                        <p class="text-sm font-medium">{{ 'common.noData' | translate }}</p>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>